# Write a full-featured index.html into /mnt/data/masolas.txt that restores the full table UI with requested features.
html = r"""<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>K√©zilabda stat ‚Äì V5 (helyre√°ll√≠tott, jav√≠tott)</title>
<meta name="theme-color" content="#1b5cff">
<style>
  :root{
    --bg:#0b0c0f; --panel:#0f1218; --card:#101522; --muted:#94a3b8; --text:#e6edf6;
    --accent:#1b5cff; --ok:#16a34a; --warn:#f59e0b; --danger:#ef4444; --border:#1f283a; --chip:#0f1a2a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:11px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .topbar{position:sticky;top:0;z-index:50;background:var(--panel);border-bottom:1px solid var(--border)}
  .wrap{max-width:1200px;margin:0 auto;padding:6px 8px;display:flex;gap:6px;flex-wrap:wrap;align-items:center}
  .brand{font-weight:800;letter-spacing:.2px}
  .pill{display:flex;gap:6px;align-items:center;padding:3px 6px;border:1px solid var(--border);background:var(--chip);border-radius:6px}
  .pill input,.pill select{border:0;background:transparent;outline:none;color:var(--text);font-size:11px}
  .btn{border:1px solid var(--border);background:var(--card);color:var(--text);border-radius:6px;padding:3px 6px;cursor:pointer;font-size:11px;display:inline-flex;align-items:center;gap:4px}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.ok{background:var(--ok);color:#fff}
  .btn.warn{background:var(--warn);color:#000}
  .btn.dan{background:var(--danger);color:#fff}
  .timer{font-variant-numeric:tabular-nums;font-size:14px;font-weight:800;padding:2px 6px;border-radius:6px;border:1px solid var(--border);background:var(--card)}
  .container{max-width:1200px;margin:10px auto;padding:0 8px;display:grid;gap:8px}
  .grid{display:grid;grid-template-columns:1fr;gap:8px}
  @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
  .card{border:1px solid var(--border);border-radius:8px;background:var(--card)}
  .inner{padding:8px}
  .teamhdr{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
  .teamleft{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .table-wrap{overflow:auto;border:1px solid var(--border);border-radius:8px}
  table{width:100%;border-collapse:collapse;font-size:10.5px;table-layout:fixed}
  thead th{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--border);padding:2px 4px;text-align:center;font-weight:800;z-index:1}
  tbody td{border-bottom:1px solid var(--border);padding:2px 3px;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  td.left,th.left{text-align:left}
  .sticky-col{position:sticky;left:0;background:var(--card);z-index:2}
  .sticky-col::after{content:"";position:absolute;right:-1px;top:0;bottom:0;width:1px;background:var(--border)}
  .namecell{display:flex;gap:3px;align-items:center}
  .num{width:2.6rem;text-align:center;padding:2px 3px;border:1px solid var(--border);border-radius:4px;background:var(--panel);color:var(--text);font-size:10.5px}
  .name{flex:1;min-width:100px;padding:2px 4px;border:1px solid var(--border);border-radius:4px;background:var(--panel);color:var(--text);font-size:10.5px}
  .enroll{width:1.1rem;height:1.1rem}
  .inactive{opacity:.55}
  .onbtn{cursor:pointer;padding:2px 6px;border-radius:6px;border:1px solid var(--border);font-weight:800}
  .onbtn.on{background:#16a34a;color:#fff}
  .onbtn.off{background:#6b7280;color:#fff}
  .twoPtoggle{margin-left:6px;padding:0 6px;border-radius:10px;border:1px solid var(--border);background:#2a1a1a;color:#fff;cursor:pointer}
  .twoPtoggle.active{background:#ef4444}
  .susp-badge{display:inline-block;margin-left:6px;padding:0 6px;border-radius:999px;background:#ef4444;color:#fff;font-weight:800}
  .hint{color:var(--muted);font-size:10px}
  tr.selected{outline:2px solid var(--accent);outline-offset:-2px}
  .left.sticky-col{cursor:pointer}
  .time-edit{display:none;gap:6px;align-items:center}
  .time-edit.on{display:flex}
  .time-edit input{width:64px;text-align:center;border:1px solid var(--border);border-radius:6px;background:var(--panel);color:var(--text);padding:2px 4px}
  .veszprem-bar{display:flex;gap:6px;align-items:center;margin:6px 8px 0}
</style>
  <!-- Export√°l√°shoz sz√ºks√©ges k√∂nyvt√°rak -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>
  <script>
// ==== Ment√©s / export / vissza√°ll√≠t√°s ====

const STORAGE_KEY_PREFIX = "kezistats_v5_";

function snapshot() {
  // A jelenlegi state-b≈ël menthet≈ë pillanatk√©p (m√©ly m√°solat)
  return JSON.parse(JSON.stringify(state));
}

function applySnapshot(snap) {
  if (!snap) return;
  pause();
  state = snap;            // teljes vissza√°ll√≠t√°s
  selectedRow = {A:null,B:null}; // kijel√∂l√©s √ºr√≠t√©se
  renderTeams();
  displayTime();
  updateUndoUI();
  <button class="btn" id="saveLocalBtn" title="Biztons√°gi ment√©s (helyi t√°rol√≥)">üíæ Ment√©s</button>
<button class="btn" id="openLocalBtn" title="Mentett meccsek megnyit√°sa">üìÇ Megnyit√°s</button>
<button class="btn" id="exportJsonBtn" title="JSON export">JSON</button>
<label class="btn" title="JSON import">
  ‚¨Ü JSON
  <input type="file" id="importJsonInput" accept="application/json" style="display:none">
</label>
<button class="btn" id="exportXlsxBtn" title="Excel export (XLSX)">XLSX</button>
<button class="btn" id="exportPdfBtn" title="PDF export">PDF</button>

}

function makeStorageKey() {
  const d = (state.matchDate || '').trim() || new Date().toISOString().slice(0,10);
  const m = (state.matchName || '').trim() || 'Ismeretlen meccs';
  return STORAGE_KEY_PREFIX + d + "___" + m;
}

function saveToLocal() {
  const key = makeStorageKey();
  const data = snapshot();
  localStorage.setItem(key, JSON.stringify({ savedAt: Date.now(), data }));
  alert("Elmentve: " + key.replace(STORAGE_KEY_PREFIX, ''));
}

function loadAllKeys() {
  const keys = [];
  for (let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if (k && k.startsWith(STORAGE_KEY_PREFIX)) keys.push(k);
  }
  // legut√≥bbi fel√ºl
  keys.sort((a,b)=> {
    const A = JSON.parse(localStorage.getItem(a)||'{}')?.savedAt || 0;
    const B = JSON.parse(localStorage.getItem(b)||'{}')?.savedAt || 0;
    return B - A;
  });
  return keys;
}

function openSavedPanel() {
  const body = document.getElementById('savedBody');
  body.innerHTML = "";
  loadAllKeys().forEach(k=>{
    const rec = JSON.parse(localStorage.getItem(k) || "{}");
    const when = new Date(rec.savedAt || Date.now()).toLocaleString();
    const parts = k.replace(STORAGE_KEY_PREFIX,'').split('___');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="padding:6px; border-bottom:1px solid #1f283a">${parts[0]||''}</td>
      <td style="padding:6px; border-bottom:1f283a">${parts[1]||''}</td>
      <td style="padding:6px; border-bottom:1px solid #1f283a; color:#94a3b8">${when}</td>
      <td style="padding:6px; border-bottom:1px solid #1f283a">
        <button class="btn btn-small" data-open="${k}">Megnyit</button>
        <button class="btn btn-small dan" data-del="${k}">T√∂r√∂l</button>
      </td>
    `.replace('1f283a','1px solid #1f283a'); // kis tr√ºkk, hogy ne h√∫zza √∂ssze a b√∂ng√©sz≈ë editor
    body.appendChild(tr);
  });

  document.querySelectorAll('[data-open]').forEach(b=>{
    b.onclick = () => {
      const k     = b.getAttribute('data-open');
      const rec   = JSON.parse(localStorage.getItem(k)||'{}');
      applySnapshot(rec.data);
      document.getElementById('savedPanel').style.display='none';
    };
  });
  document.querySelectorAll('[data-del]').forEach(b=>{
    b.onclick = () => {
      const k = b.getAttribute('data-del');
      if (confirm("Biztosan t√∂rl√∂d?")) {
        localStorage.removeItem(k);
        openSavedPanel();
      }
    };
  });

  document.getElementById('savedPanel').style.display='block';
  document.getElementById('savedSearch').value = '';
}

document.getElementById('savedSearch').addEventListener('input', (e)=>{
  const q = e.target.value.toLowerCase();
  const rows = document.querySelectorAll('#savedBody tr');
  rows.forEach(r=>{
    r.style.display = r.innerText.toLowerCase().includes(q) ? '' : 'none';
  });
});

document.getElementById('savedCloseBtn').onclick = ()=> document.getElementById('savedPanel').style.display='none';

// --- JSON export/import ---
function exportJSON() {
  const dataStr = "data:application/json;charset=utf-8," + encodeURIComponent(JSON.stringify(snapshot(), null, 2));
  const a = document.createElement('a');
  const d = (state.matchDate||'') || new Date().toISOString().slice(0,10);
  const m = (state.matchName||'meccs').replace(/[^\w\d\- ]+/g,'_').slice(0,40);
  a.setAttribute("href", dataStr);
  a.setAttribute("download", `kezistats_${d}_${m}.json`);
  document.body.appendChild(a);
  a.click(); a.remove();
}

function importJSON(file) {
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e)=>{
    try {
      const obj = JSON.parse(e.target.result);
      applySnapshot(obj);
    } catch(err){
      alert("√ârv√©nytelen JSON.");
    }
  };
  reader.readAsText(file);
}

// --- XLSX export ---
function exportXLSX() {
  if (typeof XLSX === 'undefined') { alert("XLSX k√∂nyvt√°r nem el√©rhet≈ë."); return; }
  function teamSheet(side){
    const team = state[side].players.map((p,i)=>({
      Sorsz√°m: i+1,
      Nevezett: p.active?1:0,
      Mez: p.num||'',
      N√©v: p.name||'',
      ON: p.on?1:0,
      MIN: toMMSS(p.tocSec||0),
      L√∂v√©s: p.shots||0,
      G√≥l: p.goals||0,
      '%': (p.shots? Math.round(p.goals/p.shots*100):0) + '%',
      '7A': p.p7a||0,
      '7G': p.p7g||0,
      '7%': (p.p7a? Math.round(p.p7g/p.p7a*100):0) + '%',
      TH: p.th||0,
      BL: p.bl||0,
      '2P': p.susp?1:0
    }));
    return XLSX.utils.json_to_sheet(team);
  }
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, teamSheet('A'), "Csapat A");
  XLSX.utils.book_append_sheet(wb, teamSheet('B'), "Csapat B");
  XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet([{Meccs: state.matchName||'', D√°tum: state.matchDate||'', F√©lid≈ë: state.half, Id≈ë: (state.half===1?'':'30:') + toMMSS(state.elapsed)}]), "Meta");
  const d = (state.matchDate||'') || new Date().toISOString().slice(0,10);
  const m = (state.matchName||'meccs').replace(/[^\w\d\- ]+/g,'_').slice(0,40);
  XLSX.writeFile(wb, `kezistats_${d}_${m}.xlsx`);
}

// --- PDF export ---
async function exportPDF() {
  if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') { alert("jsPDF k√∂nyvt√°r nem el√©rhet≈ë."); return; }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('l', 'pt', 'a4'); // fekv≈ë A4
  const title = `K√©zilabda stat ‚Äì ${state.matchName||''}  (${state.matchDate||''})`;
  doc.setFontSize(14); doc.text(title, 40, 40);

  function teamTable(side, yStart){
    const head = [['#','N√©v','ON','MIN','L√∂v','G√≥l','%','7A','7G','7%','TH','BL','2P']];
    const body = state[side].players.map((p,i)=>[
      p.num||'', p.name||'', p.on?'ON':'OFF', toMMSS(p.tocSec||0), p.shots||0, p.goals||0,
      (p.shots? Math.round(p.goals/p.shots*100):0)+'%',
      p.p7a||0, p.p7g||0, (p.p7a? Math.round(p.p7g/p.p7a*100):0)+'%', p.th||0, p.bl||0, p.susp?'x':''
    ]);
    doc.autoTable({
      head, body,
      startY: yStart,
      theme:'grid',
      styles: { fontSize: 8, cellPadding: 3 },
      headStyles: { fillColor: [27,92,255] },
      margin: { left: 40, right: 40 }
    });
    return doc.lastAutoTable.finalY || yStart;
  }

  let y = 70;
  doc.setFontSize(12); doc.text('Csapat A', 40, y); y+=10;
  y = teamTable('A', y+4) + 16;
  doc.setFontSize(12); doc.text('Csapat B', 40, y); y+=10;
  teamTable('B', y+4);

  const d = (state.matchDate||'') || new Date().toISOString().slice(0,10);
  const m = (state.matchName||'meccs').replace(/[^\w\d\- ]+/g,'_').slice(0,40);
  doc.save(`kezistats_${d}_${m}.pdf`);
}

// --- gombok k√∂t√©se ---
document.getElementById('saveLocalBtn').onclick = saveToLocal;
document.getElementById('openLocalBtn').onclick = openSavedPanel;
document.getElementById('exportJsonBtn').onclick = exportJSON;
document.getElementById('importJsonInput').onchange = (e)=> importJSON(e.target.files?.[0]);
document.getElementById('exportXlsxBtn').onclick = exportXLSX;
document.getElementById('exportPdfBtn').onclick  = exportPDF;

// --- kis automent√©s: 2 percenk√©nt (nem tolakod√≥) ---
setInterval(()=> {
  try {
    const key = makeStorageKey();
    localStorage.setItem(key + "_autosave", JSON.stringify({ savedAt: Date.now(), data: snapshot() }));
  } catch(_) {}
}, 120000);
</script>


</head>
<body>

<div class="topbar">
  <div class="wrap">
    <div class="brand">K√©zilabda stat ‚Äì V5</div>

    <span class="pill">M√©rk≈ëz√©s: <input id="matchName" placeholder="Pl. Veszpr√©m‚ÄìSzeged"></span>
    <span class="pill">D√°tum: <input id="matchDate" type="date"></span>

    <span class="pill">F√©lid≈ë: <span id="halfLabel">1.</span></span>
    <span class="timer" id="clock">00:00</span>

    <button class="btn primary" id="startBtn">‚ñ∂Ô∏é</button>
    <button class="btn" id="pauseBtn">‚è∏Ô∏é</button>
    <button class="btn warn" id="switchHalfBtn">F√©lid≈ë v√°lt√°s</button>

    <span class="pill">TOC m√≥d:
      <select id="tocModeSel">
        <option value="simple" selected>Egyszer≈±</option>
        <option value="detailed">R√©szletes</option>
      </select>
    </span>

    <span class="pill">
      <label><input type="checkbox" id="timeEditToggle"> Id≈ë szerkeszt≈ë</label>
    </span>
    <div id="timeEditPanel" class="time-edit">
      <span class="pill">√öj id≈ë: <input type="text" id="timeInput" value="00:00" title="MM:SS"></span>
      <button class="btn" id="tMinus30">-30</button>
      <button class="btn" id="tMinus10">-10</button>
      <button class="btn" id="tPlus10">+10</button>
      <button class="btn" id="tPlus30">+30</button>
      <button class="btn ok" id="tApply">Be√°ll√≠t</button>
    </div>

    <button class="btn" id="undoBtn"><span>‚Ü©</span><span id="undoLabel"> Visszavon√°s</span></button>
  </div>
</div>

<div class="container">
  <div class="grid">
    <!-- CSAPAT A -->
    <div class="card">
      <div class="inner teamhdr">
        <div class="teamleft">
          <span class="pill">J√°t√©kos (A): <select id="pickerA"></select></span>
          <button class="btn ok" id="thA">TH +</button>
          <button class="btn" id="blA">BL +</button>
          <button class="btn warn" id="s2a">2P KEZD</button>
          <button class="btn" id="e2a">2P V√âGE</button>
        </div>
        <div class="teamright">
          <button class="btn" id="lockA">N√©vjegyz√©k lez√°r</button>
          <button class="btn" id="allOnA">√ñsszes be</button>
          <button class="btn" id="allOffA">√ñsszes ki</button>
          <button class="btn" id="pasteA">Gyors keret</button>
        </div>
      </div>

      <div class="veszprem-bar">
        <label class="pill"><input type="checkbox" id="vzA"> ONE Veszpr√©m keret</label>
        <button class="btn" id="vzLoadA">Beolvas</button>
        <span class="hint">A lista mindig el√©rhet≈ë; beolvas√°s ut√°n szerkeszthet≈ë √©s b≈ëv√≠thet≈ë.</span>
      </div>

      <div class="inner table-wrap">
        <table>
          <thead>
            <tr>
              <th class="left sticky-col" style="width:240px">‚úì # / N√©v (A)</th>
              <th style="width:64px">ON</th>
              <th style="width:70px">MIN</th>
              <th style="width:52px">L√∂v</th>
              <th style="width:52px">G√≥l</th>
              <th style="width:44px">%</th>
              <th style="width:44px">7A</th>
              <th style="width:44px">7G</th>
              <th style="width:44px">7%</th>
              <th style="width:52px">TH</th>
              <th style="width:52px">BL</th>
            </tr>
          </thead>
          <tbody id="bodyA"></tbody>
        </table>
      </div>

      <div id="rosterPanelA" class="inner" style="display:none">
        <div class="pill">Gyors keret beilleszt√©se (A):</div>
        <textarea id="rosterTextA" style="width:100%;min-height:120px;background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:6px"></textarea>
        <div style="display:flex;gap:6px;justify-content:flex-end;margin-top:6px">
          <button class="btn" id="rosterCancelA">M√©gse</button>
          <button class="btn ok" id="rosterApplyA">Beolvas</button>
        </div>
      </div>

      <div class="inner hint">Egyszer≈±: pipa = p√°ly√°n. R√©szletes: ON gomb. 2P alatt a MIN nem ketyeg. A n√©vre kattintva kijel√∂l√∂d a sort (2P a kijel√∂ltre megy). Az ON mellett a kis ‚Äûx‚Äù gyors 2P kapcsol√≥.</div>
    </div>

    <!-- CSAPAT B -->
    <div class="card">
      <div class="inner teamhdr">
        <div class="teamleft">
          <span class="pill">J√°t√©kos (B): <select id="pickerB"></select></span>
          <button class="btn ok" id="thB">TH +</button>
          <button class="btn" id="blB">BL +</button>
          <button class="btn warn" id="s2b">2P KEZD</button>
          <button class="btn" id="e2b">2P V√âGE</button>
        </div>
        <div class="teamright">
          <button class="btn" id="lockB">N√©vjegyz√©k lez√°r</button>
          <button class="btn" id="allOnB">√ñsszes be</button>
          <button class="btn" id="allOffB">√ñsszes ki</button>
          <button class="btn" id="pasteB">Gyors keret</button>
        </div>
      </div>

      <div class="veszprem-bar">
        <label class="pill"><input type="checkbox" id="vzB"> ONE Veszpr√©m keret</label>
        <button class="btn" id="vzLoadB">Beolvas</button>
        <span class="hint">A lista mindig el√©rhet≈ë; beolvas√°s ut√°n szerkeszthet≈ë √©s b≈ëv√≠thet≈ë.</span>
      </div>

      <div class="inner table-wrap">
        <table>
          <thead>
            <tr>
              <th class="left sticky-col" style="width:240px">‚úì # / N√©v (B)</th>
              <th style="width:64px">ON</th>
              <th style="width:70px">MIN</th>
              <th style="width:52px">L√∂v</th>
              <th style="width:52px">G√≥l</th>
              <th style="width:44px">%</th>
              <th style="width:44px">7A</th>
              <th style="width:44px">7G</th>
              <th style="width:44px">7%</th>
              <th style="width:52px">TH</th>
              <th style="width:52px">BL</th>
            </tr>
          </thead>
          <tbody id="bodyB"></tbody>
        </table>
      </div>

      <div id="rosterPanelB" class="inner" style="display:none">
        <div class="pill">Gyors keret beilleszt√©se (B):</div>
        <textarea id="rosterTextB" style="width:100%;min-height:120px;background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:6px"></textarea>
        <div style="display:flex;gap:6px;justify-content:flex-end;margin-top:6px">
          <button class="btn" id="rosterCancelB">M√©gse</button>
          <button class="btn ok" id="rosterApplyB">Beolvas</button>
        </div>
      </div>

      <div class="inner hint">Egyszer≈±: pipa = p√°ly√°n. R√©szletes: ON gomb. 2P alatt a MIN nem ketyeg. A n√©vre kattintva kijel√∂l√©s m≈±k√∂dik. ON mellett kis ‚Äûx‚Äù = 2P.</div>
    </div>
  </div>
</div>

<script>
/* ====== Seg√©d ====== */
const $=id=>document.getElementById(id);
const toMMSS=s=>{s=Math.max(0,Math.floor(s));const m=Math.floor(s/60),ss=s%60;return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0')};
const today=()=> new Date().toISOString().slice(0,10);

/* ====== √Ållapot ====== */
const MAXP=20, UNDO_LIMIT=40;
const emptyPlayer=()=>({active:true,num:"",name:"",shots:0,goals:0,p7a:0,p7g:0,th:0,bl:0,on:false,tocSec:0,susp:false});
const emptyTeam =()=>({locked:false, players:Array.from({length:MAXP}, emptyPlayer)});
let state={ matchName:"", matchDate:today(), tocMode:'simple', half:1, elapsed:0, A:emptyTeam(), B:emptyTeam() };
let tmr=null, undo=[];
let selectedRow={A:null,B:null};

/* ====== ONE Veszpr√©m keret ====== */
const ONE_VESZPREM=[
  {num:"1",name:"MIKAEL APPELGREN"},{num:"2",name:"THIAGUS PETRUS"},{num:"5",name:"IVAN MARTINOVIC"},
  {num:"9",name:"HUGO DESCAT"},{num:"12",name:"RODRIGO CORRALES"},{num:"15",name:"AHMED HESHAM"},
  {num:"21",name:"BJARKI M√ÅR EL√çSSON"},{num:"23",name:"LIGETV√ÅRI PATRIK"},{num:"24",name:"GASPER MARGUC"},
  {num:"25",name:"LUKA CINDRIC"},{num:"27",name:"DOPJERA ADAM"},{num:"29",name:"NEDIM REMILI"},
  {num:"32",name:"YANIS LENNE"},{num:"39",name:"YEHIA ELDERAA"},{num:"46",name:"DRAGAN PECHMALBEC"},
  {num:"54",name:"BALOGH BOTOND"},{num:"66",name:"G√ÅNCS-PET≈ê M√ÅT√â"},{num:"67",name:"GY≈êRI N√ÅNDOR"},
  {num:"77",name:"KARDOS M√ÅRTON CSABA"},{num:"80",name:"AHMED ADEL"},{num:"88",name:"MOLN√ÅR ROBIN"},
  {num:"90",name:"ALI ZEIN"},{num:"91",name:"V√ÅRADY-SZAB√ì L√ÅSZL√ì"},{num:"97",name:"SZAB√ì LEVENTE"},
  {num:"98",name:"BARNA J√ÅNOS D√ÅNIEL"},
];

/* ====== Undo ====== */
function pushUndoTime(label, prev){undo.unshift({type:'time',label,prev}); if(undo.length>UNDO_LIMIT)undo.pop(); updateUndoUI();}
function pushUndoToggle(label, side,i,field,prev){undo.unshift({type:'toggle',label,side,i,field,prev}); if(undo.length>UNDO_LIMIT)undo.pop(); updateUndoUI();}
function pushUndoDelta(label, side,i,field,delta){undo.unshift({type:'delta',label,side,i,field,delta}); if(undo.length>UNDO_LIMIT)undo.pop(); updateUndoUI();}
function updateUndoUI(){ const u=undo[0]; $('undoLabel').textContent=u?(' '+u.label):' Visszavon√°s'; $('undoBtn').disabled=!u; }

/* ====== Id≈ë / F√©lid≈ëk ====== */
function displayTime(){
  // 1. f√©lid≈ë: 00:00..30:00; 2. f√©lid≈ë: 30:00..60:00
  const base = (state.half===1?0:30*60);
  $('clock').textContent = toMMSS(base + state.elapsed);
  $('halfLabel').textContent = state.half + '.';
  $('timeInput').value = toMMSS(base + state.elapsed);
}
function start(){ if(tmr) return; tmr=setInterval(tick,1000); }
function pause(){ if(!tmr) return; clearInterval(tmr); tmr=null; }
function tick(){
  const limit = (state.half===1?30*60:30*60); // minden f√©lid≈ë 30 perc saj√°t sz√°ml√°l√≥ban
  if(state.elapsed < limit) state.elapsed++;
  // TOC ketyegtet√©s
  ['A','B'].forEach(side=> state[side].players.forEach(p=>{
    const on = (state.tocMode==='simple') ? p.active : p.on;
    if(on && !p.susp) p.tocSec++;
  }));
  renderTeams();
  displayTime();
}
function switchHalf(){
  pause();
  state.half = (state.half===1?2:1);
  state.elapsed = 0; // √∫j f√©lid≈ë saj√°t 0-t√≥l sz√°mol; kijelz≈ën 30:00..60:00 lesz
  displayTime();
}
function shiftClock(sec){
  const prevBase = (state.half===1?0:30*60) + state.elapsed;
  const newAbs = Math.max(0, prevBase + sec);
  const newHalf = newAbs<30*60 ? 1 : 2;
  const newElapsed = newAbs - (newHalf===1?0:30*60);
  pushUndoTime('Id≈ë: '+(sec>0?'+':'')+sec+' mp', prevBase);
  state.half=newHalf; state.elapsed=newElapsed; displayTime();
}
function setClockAbs(mmss){
  const m=mmss.match(/^(\d{1,2}):([0-5]\d)$/); if(!m) return alert('Form√°tum: MM:SS');
  const abs = parseInt(m[1],10)*60 + parseInt(m[2],10);
  const prevAbs = (state.half===1?0:30*60)+state.elapsed;
  state.half = abs<30*60?1:2;
  state.elapsed = abs - (state.half===1?0:30*60);
  pushUndoTime('Id≈ë be√°ll√≠tva: '+mmss, prevAbs);
  displayTime();
}

/* ====== Render ====== */
function populatePicker(side){
  const pick=(side==='A')?$('pickerA'):$('pickerB'); pick.innerHTML="";
  state[side].players.forEach((p,i)=>{ const o=document.createElement('option'); o.value=i; o.textContent=`${p.num||i+1} ‚Äì ${p.name||('J√°t√©kos '+(i+1))}`; pick.appendChild(o); });
  if(selectedRow[side]!=null) pick.value=selectedRow[side];
}
function renderTeam(side){
  const body = document.querySelector(side==='A'?'#bodyA':'#bodyB'); body.innerHTML="";
  const team = state[side];
  team.players.forEach((p,i)=>{
    const tr=document.createElement('tr'); if(!p.active) tr.classList.add('inactive'); if(selectedRow[side]===i) tr.classList.add('selected');

    // bal cella
    const td=document.createElement('td'); td.className='left sticky-col';
    const wrap=document.createElement('div'); wrap.className='namecell';
    const chk=document.createElement('input'); chk.type='checkbox'; chk.className='enroll'; chk.checked=p.active;
    chk.addEventListener('change',()=>{ pushUndoToggle('Nevez√©s',side,i,'active',p.active); p.active=chk.checked; renderTeams(); });
    const num=document.createElement('input'); num.className='num'; num.placeholder='#'; num.value=p.num; num.addEventListener('input',()=>{ p.num=num.value; populatePicker(side); });
    const name=document.createElement('input'); name.className='name'; name.placeholder='N√©v'; name.value=p.name; name.addEventListener('input',()=>{ p.name=name.value; populatePicker(side); });
    wrap.append(chk,num,name); td.append(wrap);
    td.addEventListener('click',ev=>{ if(ev.target.tagName==='INPUT') return; selectedRow[side]=(selectedRow[side]===i?null:i); populatePicker(side); renderTeams(); });
    tr.append(td);

    // ON + 2P "x"
    const tdOn=document.createElement('td');
    const onb=document.createElement('button'); onb.className='onbtn '+(p.on?'on':'off'); onb.textContent=p.on?'ON':'OFF'; onb.disabled=(state.tocMode!=='detailed'); onb.style.opacity=(state.tocMode==='detailed')?'1':'.5';
    onb.addEventListener('click',()=>{ pushUndoToggle('ON/OFF',side,i,'on',p.on); p.on=!p.on; renderTeams(); });
    const two=document.createElement('button'); two.className='twoPtoggle'+(p.susp?' active':''); two.textContent='x'; two.title='2 perc gyors kapcsol√≥';
    two.addEventListener('click',()=>{ pushUndoToggle('2P',side,i,'susp',p.susp); p.susp=!p.susp; renderTeams(); });
    tdOn.append(onb,two); tr.append(tdOn);

    // MIN
    const tdMin=document.createElement('td'); tdMin.textContent=toMMSS(p.tocSec); if(p.susp){ const b=document.createElement('span'); b.className='susp-badge'; b.textContent='2P'; tdMin.appendChild(b); } tr.append(tdMin);

    // stat cell√°k
    const mk=(val,fn)=>{ const td=document.createElement('td'); td.textContent=val; td.style.cursor='pointer'; td.addEventListener('click',()=>{ fn(); renderTeams(); }); return td; };
    tr.append( mk(p.shots,()=>{ p.shots++; pushUndoDelta('L√∂v√©s',side,i,'shots',-1); }) );
    tr.append( mk(p.goals,()=>{ p.goals++; p.shots++; pushUndoDelta('G√≥l',side,i,'_goal',-1); }) );
    const tdPct=document.createElement('td'); tdPct.textContent= p.shots? Math.round(p.goals/p.shots*100)+'%':'0%'; tr.append(tdPct);
    tr.append( mk(p.p7a,()=>{ p.p7a++; p.shots++; pushUndoDelta('7A',side,i,'_7a',-1); }) );
    tr.append( mk(p.p7g,()=>{ p.p7g++; p.p7a++; p.shots++; p.goals++; pushUndoDelta('7G',side,i,'_7g',-1); }) );
    const td7p=document.createElement('td'); td7p.textContent= p.p7a? Math.round(p.p7g/p.p7a*100)+'%':'0%'; tr.append(td7p);
    tr.append( mk(p.th,()=>{ p.th++; pushUndoDelta('TH',side,i,'th',-1); }) );
    tr.append( mk(p.bl,()=>{ p.bl++; pushUndoDelta('BL',side,i,'bl',-1); }) );

    body.append(tr);
  });
}
function renderTeams(){ renderTeam('A'); renderTeam('B'); }

/* ====== Esem√©nyek ====== */
$('startBtn').addEventListener('click', start);
$('pauseBtn').addEventListener('click', pause);
$('switchHalfBtn').addEventListener('click', switchHalf);
$('tocModeSel').addEventListener('change', e=>{ state.tocMode=e.target.value; renderTeams(); });

$('timeEditToggle').addEventListener('change', e=>{ $('timeEditPanel').classList.toggle('on', e.target.checked); });
$('tMinus30').addEventListener('click', ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(-30); });
$('tMinus10').addEventListener('click', ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(-10); });
$('tPlus10').addEventListener('click',  ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(+10); });
$('tPlus30').addEventListener('click',  ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(+30); });
$('tApply').addEventListener('click',   ()=>{ if(!$('timeEditToggle').checked) return; setClockAbs($('timeInput').value); });

function idx(side){ const sel=selectedRow[side]; if(sel!=null) return sel; const pick=(side==='A')?$('pickerA'):$('pickerB'); return parseInt(pick.value||'0',10)||0; }
$('s2a').addEventListener('click', ()=>{ const i=idx('A'); const p=state.A.players[i]; pushUndoToggle('2P kezd', 'A', i,'susp',p.susp); p.susp=true; renderTeams(); });
$('e2a').addEventListener('click', ()=>{ const i=idx('A'); const p=state.A.players[i]; pushUndoToggle('2P v√©ge', 'A', i,'susp',p.susp); p.susp=false; renderTeams(); });
$('s2b').addEventListener('click', ()=>{ const i=idx('B'); const p=state.B.players[i]; pushUndoToggle('2P kezd', 'B', i,'susp',p.susp); p.susp=true; renderTeams(); });
$('e2b').addEventListener('click', ()=>{ const i=idx('B'); const p=state.B.players[i]; pushUndoToggle('2P v√©ge', 'B', i,'susp',p.susp); p.susp=false; renderTeams(); });

$('allOnA').addEventListener('click', ()=>{ state.A.players.forEach(p=>{p.active=true;if(state.tocMode==='detailed')p.on=true}); renderTeams(); });
$('allOffA').addEventListener('click',()=>{ state.A.players.forEach(p=>{p.active=false;if(state.tocMode==='detailed')p.on=false}); renderTeams(); });
$('allOnB').addEventListener('click', ()=>{ state.B.players.forEach(p=>{p.active=true;if(state.tocMode==='detailed')p.on=true}); renderTeams(); });
$('allOffB').addEventListener('click',()=>{ state.B.players.forEach(p=>{p.active=false;if(state.tocMode==='detailed')p.on=false}); renderTeams(); });

$('lockA').addEventListener('click', ()=>{ state.A.locked=!state.A.locked; renderTeams(); });
$('lockB').addEventListener('click', ()=>{ state.B.locked=!state.B.locked; renderTeams(); });

$('thA').addEventListener('click', ()=>{ const i=parseInt($('pickerA').value||'0',10); const p=state.A.players[i]; p.th++; pushUndoDelta('TH', 'A', i, 'th', -1); renderTeams(); });
$('blA').addEventListener('click', ()=>{ const i=parseInt($('pickerA').value||'0',10); const p=state.A.players[i]; p.bl++; pushUndoDelta('BL', 'A', i, 'bl', -1); renderTeams(); });
$('thB').addEventListener('click', ()=>{ const i=parseInt($('pickerB').value||'0',10); const p=state.B.players[i]; p.th++; pushUndoDelta('TH', 'B', i, 'th', -1); renderTeams(); });
$('blB').addEventListener('click', ()=>{ const i=parseInt($('pickerB').value||'0',10); const p=state.B.players[i]; p.bl++; pushUndoDelta('BL', 'B', i, 'bl', -1); renderTeams(); });

function applyRosterText(side, text){
  const lines=text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean).slice(0,MAXP);
  lines.forEach((ln,i)=>{
    const m=ln.match(/^#?\s*(\d+)\s*[‚Äì-]?\s+(.*)$/);
    if(m){ state[side].players[i].num=m[1]; state[side].players[i].name=m[2]; }
    else { state[side].players[i].name=ln; state[side].players[i].num=String(i+1); }
    state[side].players[i].active=true;
  });
  renderTeams();
}
$('pasteA').addEventListener('click', ()=>{ const p=$('rosterPanelA'); p.style.display=(p.style.display==='none'?'block':'none'); });
$('pasteB').addEventListener('click', ()=>{ const p=$('rosterPanelB'); p.style.display=(p.style.display==='none'?'block':'none'); });
$('rosterCancelA').addEventListener('click', ()=> $('rosterPanelA').style.display='none');
$('rosterCancelB').addEventListener('click', ()=> $('rosterPanelB').style.display='none');
$('rosterApplyA').addEventListener('click', ()=>{ applyRosterText('A', $('rosterTextA').value); $('rosterPanelA').style.display='none'; });
$('rosterApplyB').addEventListener('click', ()=>{ applyRosterText('B', $('rosterTextB').value); $('rosterPanelB').style.display='none'; });

function loadVeszpremInto(side){ ONE_VESZPREM.slice(0,MAXP).forEach((pl,i)=>{ state[side].players[i].num=pl.num; state[side].players[i].name=pl.name; state[side].players[i].active=true; }); renderTeams(); }
$('vzLoadA').addEventListener('click', ()=>{ if($('vzA').checked) loadVeszpremInto('A'); else alert('Pip√°ld be: ONE Veszpr√©m keret'); });
$('vzLoadB').addEventListener('click', ()=>{ if($('vzB').checked) loadVeszpremInto('B'); else alert('Pip√°ld be: ONE Veszpr√©m keret'); });

$('undoBtn').addEventListener('click', ()=>{
  const u=undo.shift(); if(!u) return;
  if(u.type==='time'){ const abs=u.prev; state.half = abs<30*60?1:2; state.elapsed = abs - (state.half===1?0:30*60); displayTime(); }
  else if(u.type==='toggle'){ const p=state[u.side].players[u.i]; if(p) { p[u.field]=u.prev; renderTeams(); } }
  else if(u.type==='delta'){ const p=state[u.side].players[u.i]; if(!p) return;
    if(u.field==='_goal'){ p.goals=Math.max(0,p.goals+u.delta); p.shots=Math.max(0,p.shots+u.delta); }
    else if(u.field==='_7a'){ p.p7a=Math.max(0,p.p7a+u.delta); p.shots=Math.max(0,p.shots+u.delta); }
    else if(u.field==='_7g'){ p.p7g=Math.max(0,p.p7g+u.delta); p.p7a=Math.max(0,p.p7a+u.delta); p.shots=Math.max(0,p.shots+u.delta); p.goals=Math.max(0,p.goals+u.delta); }
    else { p[u.field]=Math.max(0,(p[u.field]||0)+u.delta); }
    renderTeams();
  }
  updateUndoUI();
});

/* ====== Init ====== */
function init(){
  $('matchDate').value = state.matchDate;
  populatePicker('A'); populatePicker('B');
  renderTeams(); displayTime(); updateUndoUI();
}
init();
</script>

</body>
</html>
"""
open('/mnt/data/masolas.txt','w',encoding='utf-8').write(html)
print("OK - /mnt/data/masolas.txt friss√≠tve a teljes helyre√°ll√≠tott programmal.")
