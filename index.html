<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kézilabda stat – V6 javított</title>
<meta name="theme-color" content="#1b5cff">
<style>
  body{margin:0;font:12px system-ui;background:#0b0c0f;color:#e6edf6}
  .topbar{position:sticky;top:0;background:#111;border-bottom:1px solid #333;padding:4px;display:flex;gap:6px;flex-wrap:wrap;align-items:center}
  .btn{padding:3px 6px;border:1px solid #333;border-radius:4px;background:#222;color:#fff;cursor:pointer}
  .btn.on{background:#16a34a}.btn.off{background:#6b7280}.btn.susp{background:#ef4444}
  table{border-collapse:collapse;width:100%} th,td{border:1px solid #333;padding:2px 4px;font-size:11px;text-align:center}
  th.left,td.left{text-align:left} input.num{width:30px} input.name{width:120px}
  .timer{font-size:16px;font-weight:bold;padding:2px 6px;background:#222;border-radius:4px}
  .suspmark{color:#ef4444;font-weight:bold;margin-left:4px;cursor:pointer}
</style>
</head>
<body>
<div class="topbar">
  <span>Félidő: <span id="halfLabel">1</span></span>
  <span class="timer" id="clock">00:00</span>
  <button class="btn" id="startBtn">▶️</button>
  <button class="btn" id="pauseBtn">⏸️</button>
  <button class="btn" id="switchHalfBtn">Félidő váltás</button>
  <select id="tocModeSel">
    <option value="simple">Egyszerű</option>
    <option value="detailed">Részletes</option>
  </select>
  <button class="btn" id="undoBtn">↩ Visszavonás</button>
</div>

<div style="display:flex;gap:10px;flex-wrap:wrap">
  <div style="flex:1">
    <h3>Csapat A</h3>
    <table><thead><tr><th class="left"># Név</th><th>ON/OFF</th><th>MIN</th></tr></thead><tbody id="bodyA"></tbody></table>
  </div>
  <div style="flex:1">
    <h3>Csapat B</h3>
    <table><thead><tr><th class="left"># Név</th><th>ON/OFF</th><th>MIN</th></tr></thead><tbody id="bodyB"></tbody></table>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
const toMMSS=s=>{s=Math.floor(s);let m=Math.floor(s/60),ss=s%60;return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0')};

const MAXP=7;
const empty=()=>({num:"",name:"",active:true,on:false,sec:0,susp:false});
let state={half:1,time:0,running:false,mode:'simple',A:Array.from({length:MAXP},empty),B:Array.from({length:MAXP},empty)};
let timer=null,undo=[];

function renderTeam(side){
  const body=$(side==='A'?'bodyA':'bodyB'); body.innerHTML="";
  state[side].forEach((p,i)=>{
    const tr=document.createElement('tr');
    const td=document.createElement('td');td.className='left';
    const num=document.createElement('input');num.className='num';num.value=p.num;num.oninput=e=>p.num=e.target.value;
    const name=document.createElement('input');name.className='name';name.value=p.name;name.oninput=e=>p.name=e.target.value;
    td.append(num,name); if(p.susp){const x=document.createElement('span');x.textContent='✖';x.className='suspmark';x.onclick=()=>{pushUndo(side,i,'susp',p.susp);p.susp=!p.susp;render()};td.append(x)}; tr.append(td);
    const td2=document.createElement('td');
    const b=document.createElement('button'); b.className='btn '+(p.on?'on':'off'); b.textContent=p.on?'ON':'OFF';
    b.onclick=()=>{if(state.mode==='detailed'){pushUndo(side,i,'on',p.on);p.on=!p.on;render()}}; td2.append(b); tr.append(td2);
    const td3=document.createElement('td');td3.textContent=toMMSS(p.sec); tr.append(td3);
    body.append(tr);
  });
}
function render(){
  $('halfLabel').textContent=state.half;
  $('clock').textContent=toMMSS(state.time);
  renderTeam('A'); renderTeam('B');
}
function tick(){ state.time++; ['A','B'].forEach(s=>state[s].forEach(p=>{if(state.mode==='simple'?p.active: p.on){if(!p.susp)p.sec++}})); render()}
function start(){if(!timer){timer=setInterval(tick,1000)}}
function pause(){clearInterval(timer);timer=null}
$('startBtn').onclick=start; $('pauseBtn').onclick=pause;
$('switchHalfBtn').onclick=()=>{pause(); if(state.half===1){state.half=2;state.time=30*60}else{state.half=1;state.time=0} render()}
$('tocModeSel').onchange=e=>{state.mode=e.target.value;render()};
function pushUndo(side,i,field,prev){undo.unshift({side,i,field,prev});if(undo.length>20)undo.pop();}
$('undoBtn').onclick=()=>{const u=undo.shift();if(!u)return;state[u.side][u.i][u.field]=u.prev;render()}
render();
</script>
</body>
</html>
