# Write a full-featured index.html into /mnt/data/masolas.txt that restores the full table UI with requested features.
html = r"""<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kézilabda stat – V5 (helyreállított, javított)</title>
<meta name="theme-color" content="#1b5cff">
<style>
  :root{
    --bg:#0b0c0f; --panel:#0f1218; --card:#101522; --muted:#94a3b8; --text:#e6edf6;
    --accent:#1b5cff; --ok:#16a34a; --warn:#f59e0b; --danger:#ef4444; --border:#1f283a; --chip:#0f1a2a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:11px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .topbar{position:sticky;top:0;z-index:50;background:var(--panel);border-bottom:1px solid var(--border)}
  .wrap{max-width:1200px;margin:0 auto;padding:6px 8px;display:flex;gap:6px;flex-wrap:wrap;align-items:center}
  .brand{font-weight:800;letter-spacing:.2px}
  .pill{display:flex;gap:6px;align-items:center;padding:3px 6px;border:1px solid var(--border);background:var(--chip);border-radius:6px}
  .pill input,.pill select{border:0;background:transparent;outline:none;color:var(--text);font-size:11px}
  .btn{border:1px solid var(--border);background:var(--card);color:var(--text);border-radius:6px;padding:3px 6px;cursor:pointer;font-size:11px;display:inline-flex;align-items:center;gap:4px}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.ok{background:var(--ok);color:#fff}
  .btn.warn{background:var(--warn);color:#000}
  .btn.dan{background:var(--danger);color:#fff}
  .timer{font-variant-numeric:tabular-nums;font-size:14px;font-weight:800;padding:2px 6px;border-radius:6px;border:1px solid var(--border);background:var(--card)}
  .container{max-width:1200px;margin:10px auto;padding:0 8px;display:grid;gap:8px}
  .grid{display:grid;grid-template-columns:1fr;gap:8px}
  @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
  .card{border:1px solid var(--border);border-radius:8px;background:var(--card)}
  .inner{padding:8px}
  .teamhdr{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
  .teamleft{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .table-wrap{overflow:auto;border:1px solid var(--border);border-radius:8px}
  table{width:100%;border-collapse:collapse;font-size:10.5px;table-layout:fixed}
  thead th{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--border);padding:2px 4px;text-align:center;font-weight:800;z-index:1}
  tbody td{border-bottom:1px solid var(--border);padding:2px 3px;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  td.left,th.left{text-align:left}
  .sticky-col{position:sticky;left:0;background:var(--card);z-index:2}
  .sticky-col::after{content:"";position:absolute;right:-1px;top:0;bottom:0;width:1px;background:var(--border)}
  .namecell{display:flex;gap:3px;align-items:center}
  .num{width:2.6rem;text-align:center;padding:2px 3px;border:1px solid var(--border);border-radius:4px;background:var(--panel);color:var(--text);font-size:10.5px}
  .name{flex:1;min-width:100px;padding:2px 4px;border:1px solid var(--border);border-radius:4px;background:var(--panel);color:var(--text);font-size:10.5px}
  .enroll{width:1.1rem;height:1.1rem}
  .inactive{opacity:.55}
  .onbtn{cursor:pointer;padding:2px 6px;border-radius:6px;border:1px solid var(--border);font-weight:800}
  .onbtn.on{background:#16a34a;color:#fff}
  .onbtn.off{background:#6b7280;color:#fff}
  .twoPtoggle{margin-left:6px;padding:0 6px;border-radius:10px;border:1px solid var(--border);background:#2a1a1a;color:#fff;cursor:pointer}
  .twoPtoggle.active{background:#ef4444}
  .susp-badge{display:inline-block;margin-left:6px;padding:0 6px;border-radius:999px;background:#ef4444;color:#fff;font-weight:800}
  .hint{color:var(--muted);font-size:10px}
  tr.selected{outline:2px solid var(--accent);outline-offset:-2px}
  .left.sticky-col{cursor:pointer}
  .time-edit{display:none;gap:6px;align-items:center}
  .time-edit.on{display:flex}
  .time-edit input{width:64px;text-align:center;border:1px solid var(--border);border-radius:6px;background:var(--panel);color:var(--text);padding:2px 4px}
  .veszprem-bar{display:flex;gap:6px;align-items:center;margin:6px 8px 0}
</style>
</head>
<body>

<div class="topbar">
  <div class="wrap">
    <div class="brand">Kézilabda stat – V5</div>

    <span class="pill">Mérkőzés: <input id="matchName" placeholder="Pl. Veszprém–Szeged"></span>
    <span class="pill">Dátum: <input id="matchDate" type="date"></span>

    <span class="pill">Félidő: <span id="halfLabel">1.</span></span>
    <span class="timer" id="clock">00:00</span>

    <button class="btn primary" id="startBtn">▶︎</button>
    <button class="btn" id="pauseBtn">⏸︎</button>
    <button class="btn warn" id="switchHalfBtn">Félidő váltás</button>

    <span class="pill">TOC mód:
      <select id="tocModeSel">
        <option value="simple" selected>Egyszerű</option>
        <option value="detailed">Részletes</option>
      </select>
    </span>

    <span class="pill">
      <label><input type="checkbox" id="timeEditToggle"> Idő szerkesztő</label>
    </span>
    <div id="timeEditPanel" class="time-edit">
      <span class="pill">Új idő: <input type="text" id="timeInput" value="00:00" title="MM:SS"></span>
      <button class="btn" id="tMinus30">-30</button>
      <button class="btn" id="tMinus10">-10</button>
      <button class="btn" id="tPlus10">+10</button>
      <button class="btn" id="tPlus30">+30</button>
      <button class="btn ok" id="tApply">Beállít</button>
    </div>

    <button class="btn" id="undoBtn"><span>↩</span><span id="undoLabel"> Visszavonás</span></button>
  </div>
</div>

<div class="container">
  <div class="grid">
    <!-- CSAPAT A -->
    <div class="card">
      <div class="inner teamhdr">
        <div class="teamleft">
          <span class="pill">Játékos (A): <select id="pickerA"></select></span>
          <button class="btn ok" id="thA">TH +</button>
          <button class="btn" id="blA">BL +</button>
          <button class="btn warn" id="s2a">2P KEZD</button>
          <button class="btn" id="e2a">2P VÉGE</button>
        </div>
        <div class="teamright">
          <button class="btn" id="lockA">Névjegyzék lezár</button>
          <button class="btn" id="allOnA">Összes be</button>
          <button class="btn" id="allOffA">Összes ki</button>
          <button class="btn" id="pasteA">Gyors keret</button>
        </div>
      </div>

      <div class="veszprem-bar">
        <label class="pill"><input type="checkbox" id="vzA"> ONE Veszprém keret</label>
        <button class="btn" id="vzLoadA">Beolvas</button>
        <span class="hint">A lista mindig elérhető; beolvasás után szerkeszthető és bővíthető.</span>
      </div>

      <div class="inner table-wrap">
        <table>
          <thead>
            <tr>
              <th class="left sticky-col" style="width:240px">✓ # / Név (A)</th>
              <th style="width:64px">ON</th>
              <th style="width:70px">MIN</th>
              <th style="width:52px">Löv</th>
              <th style="width:52px">Gól</th>
              <th style="width:44px">%</th>
              <th style="width:44px">7A</th>
              <th style="width:44px">7G</th>
              <th style="width:44px">7%</th>
              <th style="width:52px">TH</th>
              <th style="width:52px">BL</th>
            </tr>
          </thead>
          <tbody id="bodyA"></tbody>
        </table>
      </div>

      <div id="rosterPanelA" class="inner" style="display:none">
        <div class="pill">Gyors keret beillesztése (A):</div>
        <textarea id="rosterTextA" style="width:100%;min-height:120px;background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:6px"></textarea>
        <div style="display:flex;gap:6px;justify-content:flex-end;margin-top:6px">
          <button class="btn" id="rosterCancelA">Mégse</button>
          <button class="btn ok" id="rosterApplyA">Beolvas</button>
        </div>
      </div>

      <div class="inner hint">Egyszerű: pipa = pályán. Részletes: ON gomb. 2P alatt a MIN nem ketyeg. A névre kattintva kijelölöd a sort (2P a kijelöltre megy). Az ON mellett a kis „x” gyors 2P kapcsoló.</div>
    </div>

    <!-- CSAPAT B -->
    <div class="card">
      <div class="inner teamhdr">
        <div class="teamleft">
          <span class="pill">Játékos (B): <select id="pickerB"></select></span>
          <button class="btn ok" id="thB">TH +</button>
          <button class="btn" id="blB">BL +</button>
          <button class="btn warn" id="s2b">2P KEZD</button>
          <button class="btn" id="e2b">2P VÉGE</button>
        </div>
        <div class="teamright">
          <button class="btn" id="lockB">Névjegyzék lezár</button>
          <button class="btn" id="allOnB">Összes be</button>
          <button class="btn" id="allOffB">Összes ki</button>
          <button class="btn" id="pasteB">Gyors keret</button>
        </div>
      </div>

      <div class="veszprem-bar">
        <label class="pill"><input type="checkbox" id="vzB"> ONE Veszprém keret</label>
        <button class="btn" id="vzLoadB">Beolvas</button>
        <span class="hint">A lista mindig elérhető; beolvasás után szerkeszthető és bővíthető.</span>
      </div>

      <div class="inner table-wrap">
        <table>
          <thead>
            <tr>
              <th class="left sticky-col" style="width:240px">✓ # / Név (B)</th>
              <th style="width:64px">ON</th>
              <th style="width:70px">MIN</th>
              <th style="width:52px">Löv</th>
              <th style="width:52px">Gól</th>
              <th style="width:44px">%</th>
              <th style="width:44px">7A</th>
              <th style="width:44px">7G</th>
              <th style="width:44px">7%</th>
              <th style="width:52px">TH</th>
              <th style="width:52px">BL</th>
            </tr>
          </thead>
          <tbody id="bodyB"></tbody>
        </table>
      </div>

      <div id="rosterPanelB" class="inner" style="display:none">
        <div class="pill">Gyors keret beillesztése (B):</div>
        <textarea id="rosterTextB" style="width:100%;min-height:120px;background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:6px"></textarea>
        <div style="display:flex;gap:6px;justify-content:flex-end;margin-top:6px">
          <button class="btn" id="rosterCancelB">Mégse</button>
          <button class="btn ok" id="rosterApplyB">Beolvas</button>
        </div>
      </div>

      <div class="inner hint">Egyszerű: pipa = pályán. Részletes: ON gomb. 2P alatt a MIN nem ketyeg. A névre kattintva kijelölés működik. ON mellett kis „x” = 2P.</div>
    </div>
  </div>
</div>

<script>
/* ====== Segéd ====== */
const $=id=>document.getElementById(id);
const toMMSS=s=>{s=Math.max(0,Math.floor(s));const m=Math.floor(s/60),ss=s%60;return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0')};
const today=()=> new Date().toISOString().slice(0,10);

/* ====== Állapot ====== */
const MAXP=20, UNDO_LIMIT=40;
const emptyPlayer=()=>({active:true,num:"",name:"",shots:0,goals:0,p7a:0,p7g:0,th:0,bl:0,on:false,tocSec:0,susp:false});
const emptyTeam =()=>({locked:false, players:Array.from({length:MAXP}, emptyPlayer)});
let state={ matchName:"", matchDate:today(), tocMode:'simple', half:1, elapsed:0, A:emptyTeam(), B:emptyTeam() };
let tmr=null, undo=[];
let selectedRow={A:null,B:null};

/* ====== ONE Veszprém keret ====== */
const ONE_VESZPREM=[
  {num:"1",name:"MIKAEL APPELGREN"},{num:"2",name:"THIAGUS PETRUS"},{num:"5",name:"IVAN MARTINOVIC"},
  {num:"9",name:"HUGO DESCAT"},{num:"12",name:"RODRIGO CORRALES"},{num:"15",name:"AHMED HESHAM"},
  {num:"21",name:"BJARKI MÁR ELÍSSON"},{num:"23",name:"LIGETVÁRI PATRIK"},{num:"24",name:"GASPER MARGUC"},
  {num:"25",name:"LUKA CINDRIC"},{num:"27",name:"DOPJERA ADAM"},{num:"29",name:"NEDIM REMILI"},
  {num:"32",name:"YANIS LENNE"},{num:"39",name:"YEHIA ELDERAA"},{num:"46",name:"DRAGAN PECHMALBEC"},
  {num:"54",name:"BALOGH BOTOND"},{num:"66",name:"GÁNCS-PETŐ MÁTÉ"},{num:"67",name:"GYŐRI NÁNDOR"},
  {num:"77",name:"KARDOS MÁRTON CSABA"},{num:"80",name:"AHMED ADEL"},{num:"88",name:"MOLNÁR ROBIN"},
  {num:"90",name:"ALI ZEIN"},{num:"91",name:"VÁRADY-SZABÓ LÁSZLÓ"},{num:"97",name:"SZABÓ LEVENTE"},
  {num:"98",name:"BARNA JÁNOS DÁNIEL"},
];

/* ====== Undo ====== */
function pushUndoTime(label, prev){undo.unshift({type:'time',label,prev}); if(undo.length>UNDO_LIMIT)undo.pop(); updateUndoUI();}
function pushUndoToggle(label, side,i,field,prev){undo.unshift({type:'toggle',label,side,i,field,prev}); if(undo.length>UNDO_LIMIT)undo.pop(); updateUndoUI();}
function pushUndoDelta(label, side,i,field,delta){undo.unshift({type:'delta',label,side,i,field,delta}); if(undo.length>UNDO_LIMIT)undo.pop(); updateUndoUI();}
function updateUndoUI(){ const u=undo[0]; $('undoLabel').textContent=u?(' '+u.label):' Visszavonás'; $('undoBtn').disabled=!u; }

/* ====== Idő / Félidők ====== */
function displayTime(){
  // 1. félidő: 00:00..30:00; 2. félidő: 30:00..60:00
  const base = (state.half===1?0:30*60);
  $('clock').textContent = toMMSS(base + state.elapsed);
  $('halfLabel').textContent = state.half + '.';
  $('timeInput').value = toMMSS(base + state.elapsed);
}
function start(){ if(tmr) return; tmr=setInterval(tick,1000); }
function pause(){ if(!tmr) return; clearInterval(tmr); tmr=null; }
function tick(){
  const limit = (state.half===1?30*60:30*60); // minden félidő 30 perc saját számlálóban
  if(state.elapsed < limit) state.elapsed++;
  // TOC ketyegtetés
  ['A','B'].forEach(side=> state[side].players.forEach(p=>{
    const on = (state.tocMode==='simple') ? p.active : p.on;
    if(on && !p.susp) p.tocSec++;
  }));
  renderTeams();
  displayTime();
}
function switchHalf(){
  pause();
  state.half = (state.half===1?2:1);
  state.elapsed = 0; // új félidő saját 0-tól számol; kijelzőn 30:00..60:00 lesz
  displayTime();
}
function shiftClock(sec){
  const prevBase = (state.half===1?0:30*60) + state.elapsed;
  const newAbs = Math.max(0, prevBase + sec);
  const newHalf = newAbs<30*60 ? 1 : 2;
  const newElapsed = newAbs - (newHalf===1?0:30*60);
  pushUndoTime('Idő: '+(sec>0?'+':'')+sec+' mp', prevBase);
  state.half=newHalf; state.elapsed=newElapsed; displayTime();
}
function setClockAbs(mmss){
  const m=mmss.match(/^(\d{1,2}):([0-5]\d)$/); if(!m) return alert('Formátum: MM:SS');
  const abs = parseInt(m[1],10)*60 + parseInt(m[2],10);
  const prevAbs = (state.half===1?0:30*60)+state.elapsed;
  state.half = abs<30*60?1:2;
  state.elapsed = abs - (state.half===1?0:30*60);
  pushUndoTime('Idő beállítva: '+mmss, prevAbs);
  displayTime();
}

/* ====== Render ====== */
function populatePicker(side){
  const pick=(side==='A')?$('pickerA'):$('pickerB'); pick.innerHTML="";
  state[side].players.forEach((p,i)=>{ const o=document.createElement('option'); o.value=i; o.textContent=`${p.num||i+1} – ${p.name||('Játékos '+(i+1))}`; pick.appendChild(o); });
  if(selectedRow[side]!=null) pick.value=selectedRow[side];
}
function renderTeam(side){
  const body = document.querySelector(side==='A'?'#bodyA':'#bodyB'); body.innerHTML="";
  const team = state[side];
  team.players.forEach((p,i)=>{
    const tr=document.createElement('tr'); if(!p.active) tr.classList.add('inactive'); if(selectedRow[side]===i) tr.classList.add('selected');

    // bal cella
    const td=document.createElement('td'); td.className='left sticky-col';
    const wrap=document.createElement('div'); wrap.className='namecell';
    const chk=document.createElement('input'); chk.type='checkbox'; chk.className='enroll'; chk.checked=p.active;
    chk.addEventListener('change',()=>{ pushUndoToggle('Nevezés',side,i,'active',p.active); p.active=chk.checked; renderTeams(); });
    const num=document.createElement('input'); num.className='num'; num.placeholder='#'; num.value=p.num; num.addEventListener('input',()=>{ p.num=num.value; populatePicker(side); });
    const name=document.createElement('input'); name.className='name'; name.placeholder='Név'; name.value=p.name; name.addEventListener('input',()=>{ p.name=name.value; populatePicker(side); });
    wrap.append(chk,num,name); td.append(wrap);
    td.addEventListener('click',ev=>{ if(ev.target.tagName==='INPUT') return; selectedRow[side]=(selectedRow[side]===i?null:i); populatePicker(side); renderTeams(); });
    tr.append(td);

    // ON + 2P "x"
    const tdOn=document.createElement('td');
    const onb=document.createElement('button'); onb.className='onbtn '+(p.on?'on':'off'); onb.textContent=p.on?'ON':'OFF'; onb.disabled=(state.tocMode!=='detailed'); onb.style.opacity=(state.tocMode==='detailed')?'1':'.5';
    onb.addEventListener('click',()=>{ pushUndoToggle('ON/OFF',side,i,'on',p.on); p.on=!p.on; renderTeams(); });
    const two=document.createElement('button'); two.className='twoPtoggle'+(p.susp?' active':''); two.textContent='x'; two.title='2 perc gyors kapcsoló';
    two.addEventListener('click',()=>{ pushUndoToggle('2P',side,i,'susp',p.susp); p.susp=!p.susp; renderTeams(); });
    tdOn.append(onb,two); tr.append(tdOn);

    // MIN
    const tdMin=document.createElement('td'); tdMin.textContent=toMMSS(p.tocSec); if(p.susp){ const b=document.createElement('span'); b.className='susp-badge'; b.textContent='2P'; tdMin.appendChild(b); } tr.append(tdMin);

    // stat cellák
    const mk=(val,fn)=>{ const td=document.createElement('td'); td.textContent=val; td.style.cursor='pointer'; td.addEventListener('click',()=>{ fn(); renderTeams(); }); return td; };
    tr.append( mk(p.shots,()=>{ p.shots++; pushUndoDelta('Lövés',side,i,'shots',-1); }) );
    tr.append( mk(p.goals,()=>{ p.goals++; p.shots++; pushUndoDelta('Gól',side,i,'_goal',-1); }) );
    const tdPct=document.createElement('td'); tdPct.textContent= p.shots? Math.round(p.goals/p.shots*100)+'%':'0%'; tr.append(tdPct);
    tr.append( mk(p.p7a,()=>{ p.p7a++; p.shots++; pushUndoDelta('7A',side,i,'_7a',-1); }) );
    tr.append( mk(p.p7g,()=>{ p.p7g++; p.p7a++; p.shots++; p.goals++; pushUndoDelta('7G',side,i,'_7g',-1); }) );
    const td7p=document.createElement('td'); td7p.textContent= p.p7a? Math.round(p.p7g/p.p7a*100)+'%':'0%'; tr.append(td7p);
    tr.append( mk(p.th,()=>{ p.th++; pushUndoDelta('TH',side,i,'th',-1); }) );
    tr.append( mk(p.bl,()=>{ p.bl++; pushUndoDelta('BL',side,i,'bl',-1); }) );

    body.append(tr);
  });
}
function renderTeams(){ renderTeam('A'); renderTeam('B'); }

/* ====== Események ====== */
$('startBtn').addEventListener('click', start);
$('pauseBtn').addEventListener('click', pause);
$('switchHalfBtn').addEventListener('click', switchHalf);
$('tocModeSel').addEventListener('change', e=>{ state.tocMode=e.target.value; renderTeams(); });

$('timeEditToggle').addEventListener('change', e=>{ $('timeEditPanel').classList.toggle('on', e.target.checked); });
$('tMinus30').addEventListener('click', ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(-30); });
$('tMinus10').addEventListener('click', ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(-10); });
$('tPlus10').addEventListener('click',  ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(+10); });
$('tPlus30').addEventListener('click',  ()=>{ if(!$('timeEditToggle').checked) return; shiftClock(+30); });
$('tApply').addEventListener('click',   ()=>{ if(!$('timeEditToggle').checked) return; setClockAbs($('timeInput').value); });

function idx(side){ const sel=selectedRow[side]; if(sel!=null) return sel; const pick=(side==='A')?$('pickerA'):$('pickerB'); return parseInt(pick.value||'0',10)||0; }
$('s2a').addEventListener('click', ()=>{ const i=idx('A'); const p=state.A.players[i]; pushUndoToggle('2P kezd', 'A', i,'susp',p.susp); p.susp=true; renderTeams(); });
$('e2a').addEventListener('click', ()=>{ const i=idx('A'); const p=state.A.players[i]; pushUndoToggle('2P vége', 'A', i,'susp',p.susp); p.susp=false; renderTeams(); });
$('s2b').addEventListener('click', ()=>{ const i=idx('B'); const p=state.B.players[i]; pushUndoToggle('2P kezd', 'B', i,'susp',p.susp); p.susp=true; renderTeams(); });
$('e2b').addEventListener('click', ()=>{ const i=idx('B'); const p=state.B.players[i]; pushUndoToggle('2P vége', 'B', i,'susp',p.susp); p.susp=false; renderTeams(); });

$('allOnA').addEventListener('click', ()=>{ state.A.players.forEach(p=>{p.active=true;if(state.tocMode==='detailed')p.on=true}); renderTeams(); });
$('allOffA').addEventListener('click',()=>{ state.A.players.forEach(p=>{p.active=false;if(state.tocMode==='detailed')p.on=false}); renderTeams(); });
$('allOnB').addEventListener('click', ()=>{ state.B.players.forEach(p=>{p.active=true;if(state.tocMode==='detailed')p.on=true}); renderTeams(); });
$('allOffB').addEventListener('click',()=>{ state.B.players.forEach(p=>{p.active=false;if(state.tocMode==='detailed')p.on=false}); renderTeams(); });

$('lockA').addEventListener('click', ()=>{ state.A.locked=!state.A.locked; renderTeams(); });
$('lockB').addEventListener('click', ()=>{ state.B.locked=!state.B.locked; renderTeams(); });

$('thA').addEventListener('click', ()=>{ const i=parseInt($('pickerA').value||'0',10); const p=state.A.players[i]; p.th++; pushUndoDelta('TH', 'A', i, 'th', -1); renderTeams(); });
$('blA').addEventListener('click', ()=>{ const i=parseInt($('pickerA').value||'0',10); const p=state.A.players[i]; p.bl++; pushUndoDelta('BL', 'A', i, 'bl', -1); renderTeams(); });
$('thB').addEventListener('click', ()=>{ const i=parseInt($('pickerB').value||'0',10); const p=state.B.players[i]; p.th++; pushUndoDelta('TH', 'B', i, 'th', -1); renderTeams(); });
$('blB').addEventListener('click', ()=>{ const i=parseInt($('pickerB').value||'0',10); const p=state.B.players[i]; p.bl++; pushUndoDelta('BL', 'B', i, 'bl', -1); renderTeams(); });

function applyRosterText(side, text){
  const lines=text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean).slice(0,MAXP);
  lines.forEach((ln,i)=>{
    const m=ln.match(/^#?\s*(\d+)\s*[–-]?\s+(.*)$/);
    if(m){ state[side].players[i].num=m[1]; state[side].players[i].name=m[2]; }
    else { state[side].players[i].name=ln; state[side].players[i].num=String(i+1); }
    state[side].players[i].active=true;
  });
  renderTeams();
}
$('pasteA').addEventListener('click', ()=>{ const p=$('rosterPanelA'); p.style.display=(p.style.display==='none'?'block':'none'); });
$('pasteB').addEventListener('click', ()=>{ const p=$('rosterPanelB'); p.style.display=(p.style.display==='none'?'block':'none'); });
$('rosterCancelA').addEventListener('click', ()=> $('rosterPanelA').style.display='none');
$('rosterCancelB').addEventListener('click', ()=> $('rosterPanelB').style.display='none');
$('rosterApplyA').addEventListener('click', ()=>{ applyRosterText('A', $('rosterTextA').value); $('rosterPanelA').style.display='none'; });
$('rosterApplyB').addEventListener('click', ()=>{ applyRosterText('B', $('rosterTextB').value); $('rosterPanelB').style.display='none'; });

function loadVeszpremInto(side){ ONE_VESZPREM.slice(0,MAXP).forEach((pl,i)=>{ state[side].players[i].num=pl.num; state[side].players[i].name=pl.name; state[side].players[i].active=true; }); renderTeams(); }
$('vzLoadA').addEventListener('click', ()=>{ if($('vzA').checked) loadVeszpremInto('A'); else alert('Pipáld be: ONE Veszprém keret'); });
$('vzLoadB').addEventListener('click', ()=>{ if($('vzB').checked) loadVeszpremInto('B'); else alert('Pipáld be: ONE Veszprém keret'); });

$('undoBtn').addEventListener('click', ()=>{
  const u=undo.shift(); if(!u) return;
  if(u.type==='time'){ const abs=u.prev; state.half = abs<30*60?1:2; state.elapsed = abs - (state.half===1?0:30*60); displayTime(); }
  else if(u.type==='toggle'){ const p=state[u.side].players[u.i]; if(p) { p[u.field]=u.prev; renderTeams(); } }
  else if(u.type==='delta'){ const p=state[u.side].players[u.i]; if(!p) return;
    if(u.field==='_goal'){ p.goals=Math.max(0,p.goals+u.delta); p.shots=Math.max(0,p.shots+u.delta); }
    else if(u.field==='_7a'){ p.p7a=Math.max(0,p.p7a+u.delta); p.shots=Math.max(0,p.shots+u.delta); }
    else if(u.field==='_7g'){ p.p7g=Math.max(0,p.p7g+u.delta); p.p7a=Math.max(0,p.p7a+u.delta); p.shots=Math.max(0,p.shots+u.delta); p.goals=Math.max(0,p.goals+u.delta); }
    else { p[u.field]=Math.max(0,(p[u.field]||0)+u.delta); }
    renderTeams();
  }
  updateUndoUI();
});

/* ====== Init ====== */
function init(){
  $('matchDate').value = state.matchDate;
  populatePicker('A'); populatePicker('B');
  renderTeams(); displayTime(); updateUndoUI();
}
init();
</script>

</body>
</html>
"""
open('/mnt/data/masolas.txt','w',encoding='utf-8').write(html)
print("OK - /mnt/data/masolas.txt frissítve a teljes helyreállított programmal.")
